"use strict";window.onload=function(){function e(e,t,s){this.tableId=e,this.row=t,this.col=s,this.maxCell=this.row*this.col,this.cell}function t(){this.col=r.col,this.row=r.row,this.maxCell=this.row*this.col,this.tableId=r.tableId,this.foodImage=d,this.cell=document.getElementById(this.tableId).children,this.keys=o,this.body=n.slice(),this.mainRow=this.body[0][0],this.mainCol=this.body[0][1],this.bgColor="bg_yellow",this.setInterval,this.course,this.body,this.xLast,this.yLast,this.posLast,this.xNext,this.yNext,this.posNext,this.xLastHead,this.yLastHead,this.posLastHead;var e=this;this.init=function(t){this.speed=t,e.setStartCell()},this.setStartCell=function(){for(var t=0;t<e.body.length;t++){var s=e.body[t][1]-1,l=(e.body[t][0]-1)*e.col,o=s+l;e.cell[o].classList.add(e.bgColor)}var a=e.body[0][1]-1,n=(e.body[0][0]-1)*e.col,d=a+n;e.cell[d].classList.add("head")},this.setNextCell=function(){if(e.xLast=e.body[e.body.length-1][1]-1,e.yLast=e.body[e.body.length-1][0]-1,e.posLast=e.xLast+e.yLast*e.col,e.body.unshift([e.mainRow,e.mainCol]),e.xNext=e.body[0][1]-1,e.yNext=e.body[0][0]-1,e.posNext=e.xNext+e.yNext*e.col,e.xLastHead=e.body[1][1]-1,e.yLastHead=(e.body[1][0]-1)*e.col,e.posLastHead=e.xLastHead+e.yLastHead,e.cell[e.posNext].classList.contains(e.foodImage)){"easy"===l?a++:"intermediate"===l?a+=2:"difficult"===l&&(a+=4);var t=document.body.getElementsByClassName("js-hiddenFact");a>=70?t[6].classList.remove("dn"):a>=60?t[5].classList.remove("dn"):a>=50?t[4].classList.remove("dn"):a>=40?t[3].classList.remove("dn"):a>=30?t[2].classList.remove("dn"):a>=20?t[1].classList.remove("dn"):a>=10&&t[0].classList.remove("dn"),e.cell[e.posNext].classList.remove(e.foodImage),e.cell[e.posNext].classList.add(e.bgColor),e.cell[e.posNext].classList.add("head"),e.cell[e.posLastHead].classList.remove("head");var s=document.getElementsByClassName("js-scoreCount__box")[0];return s.classList.contains("dn")&&s.classList.remove("dn"),s.querySelector(".js-scoreCount__count").innerHTML=a,100==e.body.length&&alert("Поздравляем! Вы выиграли!"),void r.addFood()}return e.cell[e.posLast].classList.remove(e.bgColor),e.body.pop(),e.cell[e.posNext].classList.contains(e.bgColor)?(e.clear(),document.getElementById(e.tableId).classList.add("dn"),document.querySelector(".js-showBox").classList.add("dn"),document.querySelector(".js-scoreCount__box").classList.add("dn"),document.getElementsByClassName("js-record")[0].innerHTML=a,document.getElementsByClassName("js-score")[0].value=a,void document.getElementsByClassName("js-sendBox")[0].classList.remove("dn")):(e.cell[e.posNext].classList.add(e.bgColor),e.cell[e.posNext].classList.add("head"),void e.cell[e.posLastHead].classList.remove("head"))},this.reStart=function(){e.body=n.slice(),e.mainRow=e.body[0][0],e.mainCol=e.body[0][1]},this.clear=function(){clearInterval(e.setInterval);for(var t=0;t<e.cell.length;t++)e.cell[t].className="",e.cell[t].className="table__cell";this.reStart()},this.moveLeft=function(){if("right"==e.course)return clearInterval(e.setInterval),void(e.setInterval=setInterval(e.moveRight,e.speed));e.course="left";for(var t=0;t<e.maxCell;t++)if(e.cell[t].classList.contains(e.bgColor))return e.mainCol--,e.mainCol<1?(e.mainCol=e.col,void e.setNextCell()):void e.setNextCell()},this.moveTop=function(){if("down"==e.course)return clearInterval(e.setInterval),void(e.setInterval=setInterval(e.moveDown,e.speed));e.course="top";for(var t=0;t<e.maxCell;t++)if(e.cell[t].classList.contains(e.bgColor))return e.mainRow--,e.mainRow<1?(e.mainRow=e.row,void e.setNextCell()):void e.setNextCell()},this.moveRight=function(){if("left"==e.course)return clearInterval(e.setInterval),void(e.setInterval=setInterval(e.moveLeft,e.speed));e.course="right";for(var t=0;t<e.maxCell;t++)if(e.cell[t].classList.contains(e.bgColor))return e.mainCol++,e.mainCol>e.col?(e.mainCol=1,void e.setNextCell()):void e.setNextCell()},this.moveDown=function(){if("top"==e.course)return clearInterval(e.setInterval),void(e.setInterval=setInterval(e.moveTop,e.speed));e.course="down";for(var t=0;t<e.maxCell;t++)if(e.cell[t].classList.contains(e.bgColor))return e.mainRow++,e.mainRow>e.row?(e.mainRow=1,void e.setNextCell()):void e.setNextCell()},document.addEventListener("keydown",function(t){if(clearInterval(e.setInterval),t.keyCode==e.keys.l){if(void 0==e.course)return;e.setInterval=setInterval(e.moveLeft,e.speed)}else t.keyCode==e.keys.t?e.setInterval=setInterval(e.moveTop,e.speed):t.keyCode==e.keys.r?e.setInterval=setInterval(e.moveRight,e.speed):t.keyCode==e.keys.d&&(e.setInterval=setInterval(e.moveDown,e.speed))})}function s(e){t.call(this),this.speed=e}var l,o={l:"37",t:"38",r:"39",d:"40"},a=0,n=[[1,4],[1,3],[1,2],[1,1]],d="bg_food";e.prototype.createTable=function(){var e=this,t=document.createElement("div"),s=document.body.querySelector("#form");t.id=this.tableId,t.className="table",document.body.insertBefore(t,s.nextElementSibling.nextElementSibling);for(var l=1;l<=this.maxCell;l++){var o=document.createElement("div");o.className="table__cell",t.appendChild(o)}document.getElementById(e.tableId).style.width=document.getElementById(e.tableId).children[0].offsetWidth*e.col+"px",e.cell=document.getElementById(e.tableId).children},e.prototype.addFood=function(){this.foodImage=d;var e=this,t=Math.random()*e.maxCell;"table__cell"==e.cell[Math.floor(t)].classList?e.cell[Math.floor(t)].classList.add(e.foodImage):e.addFood(e.foodImage)};var r=new e("table1",20,20);r.createTable();var i=new Audio("audio/Aleksey Semiconductor - Цыганочка.mp3");document.getElementsByClassName("js-init")[0].addEventListener("click",function(){if(document.querySelector(".form").classList.add("dn"),document.querySelector(".js-showBox").classList.remove("dn"),!(document.getElementsByClassName("bg_food").length>0)){var e=document.querySelector(".game__level:checked").value;l=document.querySelector(".game__level:checked").id;var t=new s(e);t.reStart(),t.init(e),r.addFood(),window.setTimeout(function(){document.getElementById("table1").focus()},0),i.play()}});var c=document.querySelector(".js-toggleSound");c.addEventListener("click",function(){function e(){i.paused&&i.currentTime>0&&!i.ended?(c.innerHTML="Выключить звук",i.play()):(c.innerHTML="Включить звук",i.pause())}e()}),document.getElementsByClassName("js-lostBox__send")[0].addEventListener("click",function(){var e=new XMLHttpRequest,t=document.getElementsByClassName("js-nickName")[0].value,s=document.getElementsByClassName("js-score")[0].value,l="name="+encodeURIComponent(t)+"&score="+encodeURIComponent(s);e.open("POST","/add.php",!0),e.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),e.send(l),document.getElementsByClassName("js-lostBox__send")[0].classList.add("dn"),document.getElementsByClassName("js-nickName")[0].classList.add("dn"),document.getElementsByClassName("js-results__btn")[0].classList.remove("dn"),document.getElementsByClassName("js-results__reload")[0].classList.remove("dn")}),document.getElementsByClassName("js-results__btn")[0].addEventListener("click",function(){var e=new XMLHttpRequest;e.open("GET","/get.php",!0),e.send(),e.onreadystatechange=function(){if(e.readyState==XMLHttpRequest.DONE)if(200==e.status){for(var t=function(e,t){return e[0][1]===t[0][1]?0:e[0][1]<t[0][1]?1:-1},s=e.responseText,l=s.split("-"),o=[],a=0;a<l.length;a++){var n=l[a].slice(l[a].lastIndexOf(" ")),d=l[a].slice(0,l[a].lastIndexOf(" "));n=+n,o.push([[d,n]])}o.pop(),o.sort(t);for(var r=document.querySelector(".js-results__table"),i=0;i<o.length&&20!=i;i++){var n=(o[i][0],o[i][1]),c=document.createElement("div");c.className="results__line",r.appendChild(c),c.innerHTML='<div class="results__count"></div><div class="results__nickName"></div><div class="results__score"></div>',c.querySelector(".results__count").innerHTML=i+1,c.querySelector(".results__nickName").innerHTML=o[i][0][0],c.querySelector(".results__score").innerHTML=o[i][0][1]}document.getElementsByClassName("lostBox__wrap")[0].classList.add("dn"),document.getElementsByClassName("js-results__table")[0].classList.remove("dn"),document.getElementsByClassName("js-results__btn")[0].classList.add("dn"),document.getElementById("form").classList.add("dn")}else 400==e.status?alert("There was an error 400"):alert("github pages не поддерживает динамичный контент. Я сделал динамичную таблицу рекордов, но для того, чтобы её увидеть необходима поддержка .php-файлов.")}}),document.getElementsByClassName("js-results__reload")[0].addEventListener("click",function(){location.reload()})};
